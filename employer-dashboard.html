<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - Nh√† tuy·ªÉn d·ª•ng</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Gi·ªØ nguy√™n to√†n b·ªô CSS b·∫°n ƒë√£ c√≥ */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #dc2626;
      --gray-50: #f9fafb;
      --gray-100: #f3f4f6;
      --gray-200: #e5e7eb;
      --gray-600: #4b5563;
      --gray-900: #111827;
    }

    body {
      background: var(--gray-50);
      min-height: 100vh;
    }

    /* Header */
    .dashboard-header {
      background: white;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .user-menu {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .user-info {
      text-align: right;
    }

    .user-name {
      font-weight: 600;
      color: var(--gray-900);
    }

    .user-company {
      font-size: 0.9rem;
      color: var(--gray-600);
    }

    .logout-btn {
      background: var(--danger);
      color: white;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 500;
      transition: background 0.3s ease;
    }

    .logout-btn:hover {
      background: #b91c1c;
    }

    /* Sidebar */
    .dashboard-container {
      display: flex;
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
      gap: 2rem;
    }

    .sidebar {
      width: 250px;
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      height: fit-content;
    }

    .nav-section {
      margin-bottom: 2rem;
    }

    .nav-title {
      font-size: 0.8rem;
      font-weight: 600;
      color: var(--gray-600);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-bottom: 1rem;
    }

    .nav-links {
      list-style: none;
    }

    .nav-links li {
      margin-bottom: 0.5rem;
    }

    .nav-links a {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      padding: 0.75rem 1rem;
      color: var(--gray-600);
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .nav-links a:hover, .nav-links a.active {
      background: var(--primary);
      color: white;
    }

    /* Main Content */
    .main-content {
      flex: 1;
    }

    .welcome-banner {
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      padding: 2rem;
      border-radius: 12px;
      margin-bottom: 2rem;
    }

    .welcome-banner h1 {
      font-size: 1.8rem;
      margin-bottom: 0.5rem;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      border-left: 4px solid var(--primary);
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--gray-900);
      margin-bottom: 0.5rem;
    }

    .stat-label {
      color: var(--gray-600);
      font-weight: 500;
    }

    .quick-actions {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .action-card {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      text-align: center;
      cursor: pointer;
      transition: transform 0.3s ease;
    }

    .action-card:hover {
      transform: translateY(-2px);
    }

    .action-icon {
      font-size: 2rem;
      margin-bottom: 1rem;
    }

    .action-title {
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--gray-900);
    }

    .action-description {
      color: var(--gray-600);
      font-size: 0.9rem;
    }

    .recent-activities {
      background: white;
      padding: 1.5rem;
      border-radius: 12px;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .section-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 1rem;
      color: var(--gray-900);
    }

    .activity-list {
      list-style: none;
    }

    .activity-item {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid var(--gray-200);
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--gray-100);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .activity-content {
      flex: 1;
    }

    .activity-title {
      font-weight: 500;
      margin-bottom: 0.25rem;
    }

    .activity-time {
      font-size: 0.8rem;
      color: var(--gray-600);
    }

    /* Th√™m CSS cho notification */
    .notification {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 5px;
      color: white;
      z-index: 1000;
      display: flex;
      align-items: center;
      gap: 10px;
      animation: slideIn 0.3s ease;
    }

    .notification.success { background: #28a745; }
    .notification.error { background: #dc3545; }
    .notification.info { background: #17a2b8; }

    .notification button {
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 1.2em;
    }

    @keyframes slideIn {
      from { transform: translateX(100%); }
      to { transform: translateX(0); }
    }

    @media (max-width: 768px) {
      .dashboard-container {
        flex-direction: column;
        padding: 1rem;
      }

      .sidebar {
        width: 100%;
      }

      .header-content {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
      }

      .user-info {
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="dashboard-header">
    <div class="header-content">
      <a href="index.html" class="logo">
        <span>üíº</span>
        Nh·∫≠t H√†o
      </a>
      <div class="user-menu">
        <div class="user-info">
          <div class="user-name" id="userName">Nguy·ªÖn VƒÉn A</div>
          <div class="user-company" id="userCompany">C√¥ng ty ABC</div>
        </div>
        <button class="logout-btn" onclick="logout()">ƒêƒÉng xu·∫•t</button>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <div class="dashboard-container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <nav class="nav-section">
        <div class="nav-title">T·ªïng quan</div>
        <ul class="nav-links">
          <li><a href="#dashboard" class="active">üìä B·∫£ng ƒëi·ªÅu khi·ªÉn</a></li>
        </ul>
      </nav>

      <nav class="nav-section">
        <div class="nav-title">Qu·∫£n l√Ω</div>
        <ul class="nav-links">
          <li><a href="post-job.html">üíº ƒêƒÉng tin tuy·ªÉn d·ª•ng</a></li>
          <li><a href="manage-jobs.html">üìã Qu·∫£n l√Ω tin ƒëƒÉng</a></li>
          <li><a href="candidates.html">üë• ·ª®ng vi√™n</a></li>
        </ul>
      </nav>

      <nav class="nav-section">
        <div class="nav-title">Ph√¢n t√≠ch</div>
        <ul class="nav-links">
          <li><a href="analytics.html">üìà Th·ªëng k√™</a></li>
          <li><a href="reports.html">üìä B√°o c√°o</a></li>
        </ul>
      </nav>

      <nav class="nav-section">
        <div class="nav-title">T√†i kho·∫£n</div>
        <ul class="nav-links">
          <li><a href="employer-profile.html">üë§ H·ªì s∆° c√¥ng ty</a></li>
          <li><a href="employer-settings.html">‚öôÔ∏è C√†i ƒë·∫∑t</a></li>
        </ul>
      </nav>
    </aside>

    <!-- Main Content Area -->
    <main class="main-content">
      <!-- Welcome Banner -->
      <div class="welcome-banner">
        <h1>Ch√†o m·ª´ng tr·ªü l·∫°i!</h1>
        <p>Qu·∫£n l√Ω tuy·ªÉn d·ª•ng v√† t√¨m ki·∫øm ·ª©ng vi√™n ti·ªÅm nƒÉng</p>
      </div>

      <!-- Stats Grid -->
      <div class="stats-grid">
        <div class="stat-card">
          <div class="stat-value" id="totalJobs">0</div>
          <div class="stat-label">Tin ƒëang tuy·ªÉn</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalApplications">0</div>
          <div class="stat-label">ƒê∆°n ·ª©ng tuy·ªÉn</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="newCandidates">0</div>
          <div class="stat-label">·ª®ng vi√™n m·ªõi</div>
        </div>
        <div class="stat-card">
          <div class="stat-value">85%</div>
          <div class="stat-label">T·ª∑ l·ªá ho√†n th√†nh</div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="quick-actions">
        <div class="action-card" onclick="location.href='post-job.html'">
          <div class="action-icon">üìù</div>
          <div class="action-title">ƒêƒÉng tin m·ªõi</div>
          <div class="action-description">T·∫°o tin tuy·ªÉn d·ª•ng m·ªõi</div>
        </div>
        <div class="action-card" onclick="location.href='manage-jobs.html'">
          <div class="action-icon">üìã</div>
          <div class="action-title">Qu·∫£n l√Ω tin ƒëƒÉng</div>
          <div class="action-description">Xem v√† ch·ªânh s·ª≠a tin ƒëƒÉng</div>
        </div>
        <div class="action-card" onclick="location.href='candidates.html'">
          <div class="action-icon">üë•</div>
          <div class="action-title">Xem ·ª©ng vi√™n</div>
          <div class="action-description">Duy·ªát h·ªì s∆° ·ª©ng vi√™n</div>
        </div>
        <div class="action-card" onclick="location.href='analytics.html'">
          <div class="action-icon">üìà</div>
          <div class="action-title">Ph√¢n t√≠ch</div>
          <div class="action-description">Xem b√°o c√°o hi·ªáu su·∫•t</div>
        </div>
      </div>

      <!-- Recent Activities -->
      <div class="recent-activities">
        <h3 class="section-title">Ho·∫°t ƒë·ªông g·∫ßn ƒë√¢y</h3>
        <ul class="activity-list" id="activityList">
          <!-- Activities will be loaded here -->
        </ul>
      </div>
    </main>
  </div>

  <script>
    // Ki·ªÉm tra ƒëƒÉng nh·∫≠p
    function checkAuth() {
      const loggedEmployer = localStorage.getItem('loggedEmployer') || sessionStorage.getItem('loggedEmployer');
      if (!loggedEmployer) {
        window.location.href = 'employer-login.html';
        return null;
      }
      return JSON.parse(loggedEmployer);
    }

    // Hi·ªÉn th·ªã notification
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <span>${message}</span>
        <button onclick="this.parentElement.remove()">&times;</button>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => {
        if (notification.parentElement) {
          notification.remove();
        }
      }, 3000);
    }

    // Load dashboard data - C·∫¨P NH·∫¨T
    function loadDashboardData(employer) {
      console.log('üîÑ ƒêang t·∫£i d·ªØ li·ªáu dashboard...');
      
      // C·∫≠p nh·∫≠t th√¥ng tin user
      document.getElementById('userName').textContent = employer.contactPerson;
      document.getElementById('userCompany').textContent = employer.companyName;

      // Load jobs data t·ª´ employerJobs (ƒë·ªìng b·ªô v·ªõi manage-jobs)
      const employerJobs = JSON.parse(localStorage.getItem('employerJobs') || '[]');
      console.log('üìä Jobs found in employerJobs:', employerJobs);

      // Load applications
      const applications = JSON.parse(localStorage.getItem('jobApplications') || '[]');
      const employerApplications = applications.filter(app => 
        employerJobs.some(job => job.id === app.jobId)
      );

      // Update stats
      document.getElementById('totalJobs').textContent = employerJobs.length;
      document.getElementById('totalApplications').textContent = employerApplications.length;
      
      // T√≠nh ·ª©ng vi√™n m·ªõi (7 ng√†y g·∫ßn ƒë√¢y)
      const newCandidates = employerApplications.filter(app => {
        const appliedDate = new Date(app.appliedAt);
        const today = new Date();
        const diffTime = today - appliedDate;
        const diffDays = diffTime / (1000 * 60 * 60 * 24);
        return diffDays <= 7;
      }).length;
      
      document.getElementById('newCandidates').textContent = newCandidates;

      // Load activities
      loadRecentActivities(employerJobs, employerApplications);
    }

    // Load recent activities - C·∫¨P NH·∫¨T
    function loadRecentActivities(jobs, applications) {
      const activityList = document.getElementById('activityList');
      const activities = [];

      // Add job posting activities
      jobs.slice(0, 3).forEach(job => {
        activities.push({
          icon: 'üíº',
          title: `ƒê√£ ƒëƒÉng tin: ${job.jobTitle || job.title}`,
          time: formatTimeAgo(job.datePosted || job.createdAt)
        });
      });

      // Add application activities
      applications.slice(0, 3).forEach(app => {
        activities.push({
          icon: 'üë§',
          title: `·ª®ng vi√™n m·ªõi: ${app.applicantName} ·ª©ng tuy·ªÉn ${app.jobTitle}`,
          time: formatTimeAgo(app.appliedAt)
        });
      });

      // Sort by time (m·ªõi nh·∫•t tr∆∞·ªõc)
      activities.sort((a, b) => new Date(b.time) - new Date(a.time));

      // Display activities
      activityList.innerHTML = activities.slice(0, 5).map(activity => `
        <li class="activity-item">
          <div class="activity-icon">${activity.icon}</div>
          <div class="activity-content">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-time">${activity.time}</div>
          </div>
        </li>
      `).join('');
    }

    // Format time ago
    function formatTimeAgo(dateString) {
      if (!dateString) return 'Ch∆∞a x√°c ƒë·ªãnh';
      
      const date = new Date(dateString);
      const now = new Date();
      const diffMs = now - date;
      const diffMins = Math.floor(diffMs / 60000);
      const diffHours = Math.floor(diffMs / 3600000);
      const diffDays = Math.floor(diffMs / 86400000);

      if (diffMins < 1) return 'V·ª´a xong';
      if (diffMins < 60) return `${diffMins} ph√∫t tr∆∞·ªõc`;
      if (diffHours < 24) return `${diffHours} gi·ªù tr∆∞·ªõc`;
      if (diffDays < 7) return `${diffDays} ng√†y tr∆∞·ªõc`;
      return date.toLocaleDateString('vi-VN');
    }

    // Logout
    function logout() {
      localStorage.removeItem('loggedEmployer');
      sessionStorage.removeItem('loggedEmployer');
      window.location.href = 'employer-login.html';
    }

    // H√†m th√™m c√¥ng vi·ªác m·ªõi - ƒê·ªíNG B·ªò V·ªöI MANAGE-JOBS
    function addNewJob(jobData) {
      console.log('‚ûï ƒêang th√™m c√¥ng vi·ªác m·ªõi:', jobData);
      
      // L·∫•y danh s√°ch c√¥ng vi·ªác hi·ªán t·∫°i t·ª´ localStorage
      let jobs = JSON.parse(localStorage.getItem('employerJobs')) || [];
      
      // T·∫°o job m·ªõi v·ªõi c·∫•u tr√∫c ƒë·ªìng b·ªô
      const newJob = {
        id: Date.now(), // ID duy nh·∫•t
        employerId: JSON.parse(localStorage.getItem('loggedEmployer') || sessionStorage.getItem('loggedEmployer')).id,
        jobTitle: jobData.title,
        title: jobData.title, // ƒê·ªìng b·ªô c·∫£ hai tr∆∞·ªùng
        company: jobData.company,
        location: jobData.location,
        salary: jobData.salary,
        jobType: jobData.jobType,
        description: jobData.description,
        requirements: jobData.requirements,
        datePosted: new Date().toISOString(),
        createdAt: new Date().toISOString(), // ƒê·ªìng b·ªô c·∫£ hai tr∆∞·ªùng
        status: 'active',
        applications: 0,
        applicants: 0, // ƒê·ªìng b·ªô c·∫£ hai tr∆∞·ªùng
        views: 0
      };
      
      jobs.push(newJob);
      
      // L∆∞u l·∫°i v√†o localStorage
      localStorage.setItem('employerJobs', JSON.stringify(jobs));
      console.log('üíæ ƒê√£ l∆∞u c√¥ng vi·ªác m·ªõi v√†o employerJobs:', newJob);
      
      // ƒê·ªìng b·ªô v·ªõi API n·∫øu c√≥
      try {
        if (typeof dataAPI !== 'undefined' && dataAPI.addJob) {
          dataAPI.addJob(newJob);
          console.log('üåê ƒê√£ ƒë·ªìng b·ªô v·ªõi API');
        }
      } catch (error) {
        console.log('‚ö†Ô∏è Kh√¥ng th·ªÉ ƒë·ªìng b·ªô v·ªõi API');
      }
      
      // Hi·ªÉn th·ªã th√¥ng b√°o
      showNotification('C√¥ng vi·ªác ƒë√£ ƒë∆∞·ª£c th√™m th√†nh c√¥ng!', 'success');
      
      // K√≠ch ho·∫°t s·ª± ki·ªán ƒë·ªÉ c√°c trang kh√°c bi·∫øt c√≥ thay ƒë·ªïi
      window.dispatchEvent(new Event('employerJobsUpdated'));
      
      return newJob;
    }

    // L·∫Øng nghe s·ª± ki·ªán t·ª´ c√°c trang kh√°c
    window.addEventListener('employerJobsUpdated', function() {
      console.log('üîÑ Nh·∫≠n s·ª± ki·ªán c·∫≠p nh·∫≠t jobs, reloading dashboard...');
      const employer = checkAuth();
      if (employer) {
        loadDashboardData(employer);
      }
    });

    // T·ª± ƒë·ªông refresh khi quay l·∫°i trang
    window.addEventListener('pageshow', function() {
      const employer = checkAuth();
      if (employer) {
        loadDashboardData(employer);
      }
    });

    // Kh·ªüi t·∫°o dashboard
    document.addEventListener('DOMContentLoaded', function() {
      console.log('üöÄ Kh·ªüi t·∫°o dashboard...');
      const employer = checkAuth();
      if (employer) {
        loadDashboardData(employer);
      }
    });

    // H√†m helper ƒë·ªÉ ki·ªÉm tra d·ªØ li·ªáu (d√πng cho debug)
    function debugEmployerJobs() {
      const jobs = JSON.parse(localStorage.getItem('employerJobs') || '[]');
      console.log('üêõ Debug employerJobs:', jobs);
      return jobs;
    }
  </script>
</body>
</html>